<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL to Histogram</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for creating the histogram -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl bg-white rounded-2xl shadow-lg">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Query Result Histogram Generator</h1>
            <p class="text-gray-600 mt-2">Paste your two-column data from MySQL to instantly create a bar chart.</p>
        </header>

        <main>
            <div class="flex flex-col gap-6">
                <!-- Text area for data input -->
                <div>
                    <label for="dataInput" class="block text-sm font-medium text-gray-700 mb-2">Paste Data Here:</label>
                    <textarea id="dataInput" rows="10" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="e.g.,&#10;Month	Product A	Product B&#10;January	1500	900&#10;February	2750	1200&#10;March	1200	1100"></textarea>
                </div>

                <!-- Button to generate the chart -->
                <button id="drawChartBtn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out shadow-md">
                    Generate Histogram
                </button>

                <!-- Canvas for the chart display -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <canvas id="histogramCanvas"></canvas>
                </div>
            </div>
        </main>
    </div>

    <script>
        const drawChartBtn = document.getElementById('drawChartBtn');
        const dataInput = document.getElementById('dataInput');
        const ctx = document.getElementById('histogramCanvas').getContext('2d');
        let chartInstance = null; // To hold the chart instance

        // A nice set of colors for the chart bars
        const CHART_COLORS = [
            'rgba(79, 70, 229, 0.8)',
            'rgba(255, 99, 132, 0.8)',
            'rgba(54, 162, 235, 0.8)',
            'rgba(255, 206, 86, 0.8)',
            'rgba(75, 192, 192, 0.8)',
            'rgba(153, 102, 255, 0.8)',
            'rgba(255, 159, 64, 0.8)'
        ];

        // Function to parse the input data
        function parseData(input) {
            const lines = input.trim().split('\n');
            const labels = []; // for x-axis
            
            let xAxisTitle = 'Category';
            let yAxisTitle = 'Total Value';

            if (lines.length < 2) { // Need at least a header and one data row
                return { labels, datasets: [], xAxisTitle, yAxisTitle };
            }

            // The first line is always the header
            const headerParts = lines.shift().trim().split(/\s*\t\s*/); // Split by tab and trim whitespace
            xAxisTitle = headerParts.shift() || 'Category'; // First column name is X-axis title
            const datasetLabels = headerParts;

            const datasets = datasetLabels.map(label => ({
                label: label,
                data: [],
            }));

            // Process the rest of the lines as data
            lines.forEach(line => {
                const parts = line.trim().split(/\s*\t\s*/);
                if (parts.length > 1) {
                    labels.push(parts[0]); // First item is the x-axis label
                    // The rest are data points for each dataset
                    for (let i = 1; i < parts.length; i++) {
                        if (datasets[i - 1]) {
                            const value = parseFloat(parts[i]);
                            datasets[i - 1].data.push(isNaN(value) ? 0 : value);
                        }
                    }
                }
            });

            return { labels, datasets, xAxisTitle, yAxisTitle };
        }

        // Function to draw the chart
        function drawChart() {
            const rawData = dataInput.value;
            if (!rawData.trim()) {
                // Clear chart if input is empty
                if (chartInstance) {
                    chartInstance.destroy();
                    chartInstance = null;
                }
                return;
            }

            const { labels, datasets, xAxisTitle, yAxisTitle } = parseData(rawData);

            // Destroy the previous chart instance if it exists
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Assign colors to each dataset
            const coloredDatasets = datasets.map((dataset, index) => ({
                ...dataset,
                backgroundColor: CHART_COLORS[index % CHART_COLORS.length],
                borderRadius: 5,
            }));

            // Create a new chart instance
            chartInstance = new Chart(ctx, {
                type: 'bar', // Bar chart for histogram representation
                data: {
                    labels: labels,
                    datasets: coloredDatasets,
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            backgroundColor: '#111827',
                            titleFont: { size: 16 },
                            bodyFont: { size: 14 },
                            padding: 12,
                            cornerRadius: 6,
                        }
                    },
                    scales: {
                        y: {
                            stacked: true, // Enable stacking
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: yAxisTitle,
                                font: {
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        },
                        x: {
                            stacked: true, // Enable stacking
                            title: {
                                display: true,
                                text: xAxisTitle,
                                font: {
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Event listener for the button
        drawChartBtn.addEventListener('click', drawChart);

    </script>
</body>
</html>

