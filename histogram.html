<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL to Histogram</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for creating the histogram -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl bg-white rounded-2xl shadow-lg">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Query Result Histogram Generator</h1>
            <p class="text-gray-600 mt-2">Paste your two-column data from MySQL to instantly create a bar chart.</p>
        </header>

        <main>
            <div class="flex flex-col gap-6">
                <!-- Text area for data input -->
                <div>
                    <label for="dataInput" class="block text-sm font-medium text-gray-700 mb-2">Paste Data Here:</label>
                    <textarea id="dataInput" rows="10" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="e.g.,&#10;Month	Sales&#10;January	1500&#10;February	2750&#10;March	1200"></textarea>
                </div>

                <!-- Button to generate the chart -->
                <button id="drawChartBtn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out shadow-md">
                    Generate Histogram
                </button>

                <!-- Canvas for the chart display -->
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                    <canvas id="histogramCanvas"></canvas>
                </div>
            </div>
        </main>
    </div>

    <script>
        const drawChartBtn = document.getElementById('drawChartBtn');
        const dataInput = document.getElementById('dataInput');
        const ctx = document.getElementById('histogramCanvas').getContext('2d');
        let chartInstance = null; // To hold the chart instance

        // Function to parse the input data
        function parseData(input) {
            const lines = input.trim().split('\n');
            const labels = [];
            const dataPoints = [];
            
            // Default titles
            let xAxisTitle = 'Category (1st Column)';
            let yAxisTitle = 'Value (2nd Column)';

            if (lines.length === 0) {
                return { labels, dataPoints, xAxisTitle, yAxisTitle };
            }

            // Check the first line to see if it's a header
            const firstLine = lines[0];
            const firstLineParts = firstLine.split('\t').length > 1 ? firstLine.split('\t') : firstLine.split(',');

            // If the second part of the first line is NOT a number, assume it's a header line
            if (firstLineParts.length === 2 && isNaN(parseFloat(firstLineParts[1].trim()))) {
                xAxisTitle = firstLineParts[0].trim();
                yAxisTitle = firstLineParts[1].trim();
                lines.shift(); // Remove the header line from data processing
            }

            lines.forEach(line => {
                // Split by tab, or fall back to comma
                const parts = line.split('\t').length > 1 ? line.split('\t') : line.split(',');
                
                if (parts.length === 2) {
                    const label = parts[0].trim();
                    const value = parseFloat(parts[1].trim());

                    if (label && !isNaN(value)) {
                        labels.push(label);
                        dataPoints.push(value);
                    }
                }
            });

            return { labels, dataPoints, xAxisTitle, yAxisTitle };
        }

        // Function to draw the chart
        function drawChart() {
            const rawData = dataInput.value;
            if (!rawData.trim()) {
                // Clear chart if input is empty
                if (chartInstance) {
                    chartInstance.destroy();
                    chartInstance = null;
                }
                return;
            }

            const { labels, dataPoints, xAxisTitle, yAxisTitle } = parseData(rawData);

            // Destroy the previous chart instance if it exists
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Create a new chart instance
            chartInstance = new Chart(ctx, {
                type: 'bar', // Bar chart for histogram representation
                data: {
                    labels: labels,
                    datasets: [{
                        label: yAxisTitle,
                        data: dataPoints,
                        backgroundColor: 'rgba(79, 70, 229, 0.8)', // Indigo color
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            backgroundColor: '#111827',
                            titleFont: { size: 16 },
                            bodyFont: { size: 14 },
                            padding: 12,
                            cornerRadius: 6,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: yAxisTitle,
                                font: {
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: xAxisTitle,
                                font: {
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Event listener for the button
        drawChartBtn.addEventListener('click', drawChart);

    </script>
</body>
</html>

